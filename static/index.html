<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Streaming</title>
    <link rel="stylesheet" href="styles.css">

    <script>
        function getToken() {
            return localStorage.getItem('token');
        }

        document.addEventListener("DOMContentLoaded", () => {
            const token = getToken();
            if (!token) {
                window.location.href = '/login.html';
            } else {
                fetchUserInfo();
            }
        });

        async function fetchUserInfo() {
            const token = getToken();
            if (!token) {
                return;
            }

            try {
                const response = await fetch('/api/whoami', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('username-display').textContent = data.username;
                } else {
                    throw new Error('Failed to fetch user info');
                }
            } catch (error) {
                console.error(error);
            }
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/login.html';
        }
    </script>
</head>

<svg style="display: none">
    <defs>
        <symbol id="logo" viewBox="0 0 1114 257">
            <path
                d="M164.68 174V110H180.296V115.696C182.472 113.392 185.075 111.579 188.104 110.256C191.133 108.891 194.397 108.208 197.896 108.208C202.333 108.208 206.408 109.253 210.12 111.344C213.875 113.435 216.861 116.229 219.08 119.728C221.341 116.229 224.328 113.435 228.04 111.344C231.752 109.253 235.827 108.208 240.264 108.208C244.957 108.208 249.203 109.36 253 111.664C256.84 113.925 259.891 116.976 262.152 120.816C264.456 124.613 265.608 128.859 265.608 133.552V174H249.992V137.712C249.992 135.237 249.373 132.976 248.136 130.928C246.941 128.837 245.32 127.173 243.272 125.936C241.267 124.656 239.005 124.016 236.488 124.016C233.971 124.016 231.688 124.635 229.64 125.872C227.635 127.067 226.013 128.688 224.776 130.736C223.539 132.784 222.92 135.109 222.92 137.712V174H207.304V137.712C207.304 135.109 206.707 132.784 205.512 130.736C204.317 128.688 202.696 127.067 200.648 125.872C198.6 124.635 196.317 124.016 193.8 124.016C191.325 124.016 189.064 124.656 187.016 125.936C184.968 127.173 183.325 128.837 182.088 130.928C180.893 132.976 180.296 135.237 180.296 137.712V174H164.68ZM275.87 150.32V110H291.486V146.224C291.486 148.741 292.105 151.045 293.342 153.136C294.579 155.184 296.222 156.827 298.27 158.064C300.361 159.259 302.643 159.856 305.118 159.856C307.678 159.856 309.982 159.259 312.03 158.064C314.078 156.827 315.721 155.184 316.958 153.136C318.195 151.045 318.814 148.741 318.814 146.224V110H334.43L334.494 174H318.878L318.814 168.176C316.595 170.48 313.971 172.315 310.942 173.68C307.913 175.003 304.67 175.664 301.214 175.664C296.563 175.664 292.318 174.533 288.478 172.272C284.638 169.968 281.566 166.917 279.262 163.12C277.001 159.28 275.87 155.013 275.87 150.32ZM366.185 175.152C362.857 174.939 359.636 174.277 356.521 173.168C353.449 172.016 350.718 170.459 348.329 168.496C345.94 166.533 344.105 164.187 342.825 161.456L356.009 155.824C356.521 156.677 357.353 157.595 358.505 158.576C359.657 159.515 361.022 160.304 362.601 160.944C364.222 161.584 365.993 161.904 367.913 161.904C369.534 161.904 371.07 161.691 372.521 161.264C374.014 160.795 375.209 160.091 376.105 159.152C377.044 158.213 377.513 156.997 377.513 155.504C377.513 153.925 376.958 152.709 375.849 151.856C374.782 150.96 373.417 150.299 371.753 149.872C370.132 149.403 368.553 148.976 367.017 148.592C362.964 147.781 359.188 146.523 355.689 144.816C352.233 143.109 349.438 140.912 347.305 138.224C345.214 135.493 344.169 132.208 344.169 128.368C344.169 124.144 345.278 120.496 347.497 117.424C349.758 114.352 352.681 111.984 356.265 110.32C359.892 108.656 363.796 107.824 367.977 107.824C373.054 107.824 377.705 108.891 381.929 111.024C386.196 113.115 389.566 116.08 392.041 119.92L379.689 127.216C379.092 126.192 378.26 125.253 377.193 124.4C376.126 123.504 374.91 122.779 373.545 122.224C372.18 121.627 370.75 121.285 369.257 121.2C367.337 121.115 365.588 121.285 364.009 121.712C362.43 122.139 361.15 122.864 360.169 123.888C359.23 124.912 358.761 126.277 358.761 127.984C358.761 129.605 359.401 130.821 360.681 131.632C361.961 132.4 363.497 132.997 365.289 133.424C367.124 133.851 368.873 134.32 370.537 134.832C374.292 136.069 377.812 137.584 381.097 139.376C384.425 141.168 387.092 143.365 389.097 145.968C391.102 148.571 392.062 151.685 391.977 155.312C391.977 159.451 390.74 163.077 388.265 166.192C385.79 169.264 382.59 171.611 378.665 173.232C374.782 174.853 370.622 175.493 366.185 175.152ZM401.43 110H417.046V174H401.43V110ZM409.366 101.744C407.062 101.744 405.121 100.997 403.542 99.504C401.963 97.968 401.174 96.048 401.174 93.744C401.174 91.4827 401.963 89.584 403.542 88.048C405.121 86.512 407.041 85.744 409.302 85.744C411.563 85.744 413.462 86.512 414.998 88.048C416.577 89.584 417.366 91.4827 417.366 93.744C417.366 96.048 416.598 97.968 415.062 99.504C413.526 100.997 411.627 101.744 409.366 101.744ZM470.61 154.736L484.69 162.352C481.746 166.363 478.055 169.584 473.618 172.016C469.181 174.448 464.338 175.664 459.09 175.664C453.202 175.664 447.826 174.149 442.962 171.12C438.141 168.091 434.279 164.037 431.378 158.96C428.519 153.84 427.09 148.187 427.09 142C427.09 137.307 427.922 132.933 429.586 128.88C431.25 124.784 433.533 121.2 436.434 118.128C439.378 115.013 442.791 112.581 446.674 110.832C450.557 109.083 454.695 108.208 459.09 108.208C464.338 108.208 469.181 109.424 473.618 111.856C478.055 114.288 481.746 117.552 484.69 121.648L470.61 129.2C469.117 127.493 467.346 126.171 465.298 125.232C463.293 124.293 461.223 123.824 459.09 123.824C456.018 123.824 453.245 124.677 450.77 126.384C448.295 128.048 446.333 130.267 444.882 133.04C443.431 135.771 442.706 138.757 442.706 142C442.706 145.2 443.431 148.187 444.882 150.96C446.333 153.691 448.295 155.888 450.77 157.552C453.245 159.216 456.018 160.048 459.09 160.048C461.309 160.048 463.421 159.579 465.426 158.64C467.431 157.659 469.159 156.357 470.61 154.736ZM501.62 175.664C499.401 175.664 497.503 174.896 495.924 173.36C494.388 171.781 493.62 169.861 493.62 167.6C493.62 165.424 494.388 163.547 495.924 161.968C497.503 160.389 499.401 159.6 501.62 159.6C503.839 159.6 505.737 160.389 507.316 161.968C508.895 163.547 509.684 165.424 509.684 167.6C509.684 169.861 508.895 171.781 507.316 173.36C505.737 174.896 503.839 175.664 501.62 175.664ZM525.055 174V110H540.671V115.696C542.847 113.392 545.45 111.579 548.479 110.256C551.508 108.891 554.772 108.208 558.271 108.208C562.708 108.208 566.783 109.253 570.495 111.344C574.25 113.435 577.236 116.229 579.455 119.728C581.716 116.229 584.703 113.435 588.415 111.344C592.127 109.253 596.202 108.208 600.639 108.208C605.332 108.208 609.578 109.36 613.375 111.664C617.215 113.925 620.266 116.976 622.527 120.816C624.831 124.613 625.983 128.859 625.983 133.552V174H610.367V137.712C610.367 135.237 609.748 132.976 608.511 130.928C607.316 128.837 605.695 127.173 603.647 125.936C601.642 124.656 599.38 124.016 596.863 124.016C594.346 124.016 592.063 124.635 590.015 125.872C588.01 127.067 586.388 128.688 585.151 130.736C583.914 132.784 583.295 135.109 583.295 137.712V174H567.679V137.712C567.679 135.109 567.082 132.784 565.887 130.736C564.692 128.688 563.071 127.067 561.023 125.872C558.975 124.635 556.692 124.016 554.175 124.016C551.7 124.016 549.439 124.656 547.391 125.936C545.343 127.173 543.7 128.837 542.463 130.928C541.268 132.976 540.671 135.237 540.671 137.712V174H525.055ZM638.805 110H654.421V174H638.805V110ZM646.741 101.744C644.437 101.744 642.496 100.997 640.917 99.504C639.338 97.968 638.549 96.048 638.549 93.744C638.549 91.4827 639.338 89.584 640.917 88.048C642.496 86.512 644.416 85.744 646.677 85.744C648.938 85.744 650.837 86.512 652.373 88.048C653.952 89.584 654.741 91.4827 654.741 93.744C654.741 96.048 653.973 97.968 652.437 99.504C650.901 100.997 649.002 101.744 646.741 101.744ZM707.985 154.736L722.065 162.352C719.121 166.363 715.43 169.584 710.993 172.016C706.556 174.448 701.713 175.664 696.465 175.664C690.577 175.664 685.201 174.149 680.337 171.12C675.516 168.091 671.654 164.037 668.753 158.96C665.894 153.84 664.465 148.187 664.465 142C664.465 137.307 665.297 132.933 666.961 128.88C668.625 124.784 670.908 121.2 673.809 118.128C676.753 115.013 680.166 112.581 684.049 110.832C687.932 109.083 692.07 108.208 696.465 108.208C701.713 108.208 706.556 109.424 710.993 111.856C715.43 114.288 719.121 117.552 722.065 121.648L707.985 129.2C706.492 127.493 704.721 126.171 702.673 125.232C700.668 124.293 698.598 123.824 696.465 123.824C693.393 123.824 690.62 124.677 688.145 126.384C685.67 128.048 683.708 130.267 682.257 133.04C680.806 135.771 680.081 138.757 680.081 142C680.081 145.2 680.806 148.187 682.257 150.96C683.708 153.691 685.67 155.888 688.145 157.552C690.62 159.216 693.393 160.048 696.465 160.048C698.684 160.048 700.796 159.579 702.801 158.64C704.806 157.659 706.534 156.357 707.985 154.736ZM733.619 174L733.555 110H749.171L749.235 115.696C751.411 113.392 754.014 111.579 757.043 110.256C760.072 108.891 763.336 108.208 766.835 108.208C769.182 108.208 771.528 108.549 773.875 109.232L767.731 124.976C766.11 124.336 764.488 124.016 762.867 124.016C760.35 124.016 758.046 124.635 755.955 125.872C753.907 127.067 752.264 128.709 751.027 130.8C749.832 132.848 749.235 135.131 749.235 137.648V174H733.619ZM813.845 175.664C808.64 175.664 803.904 174.469 799.637 172.08C795.37 169.648 791.68 166.299 788.565 162.032C785.493 157.765 783.125 152.837 781.461 147.248C779.797 141.616 778.965 135.6 778.965 129.2C778.965 122.8 779.797 116.805 781.461 111.216C783.125 105.584 785.493 100.635 788.565 96.368C791.68 92.1013 795.37 88.7733 799.637 86.384C803.904 83.952 808.64 82.736 813.845 82.736C819.05 82.736 823.786 83.952 828.053 86.384C832.32 88.7733 835.968 92.1013 838.997 96.368C842.069 100.635 844.437 105.584 846.101 111.216C847.808 116.805 848.661 122.8 848.661 129.2C848.661 135.6 847.808 141.616 846.101 147.248C844.437 152.837 842.069 157.765 838.997 162.032C835.968 166.299 832.32 169.648 828.053 172.08C823.786 174.469 819.05 175.664 813.845 175.664ZM813.845 160.048C818.41 160.048 822.186 158.597 825.173 155.696C828.16 152.795 830.378 148.997 831.829 144.304C833.28 139.611 834.005 134.576 834.005 129.2C834.005 123.525 833.237 118.363 831.701 113.712C830.165 109.019 827.904 105.285 824.917 102.512C821.93 99.7387 818.24 98.352 813.845 98.352C810.389 98.352 807.381 99.2053 804.821 100.912C802.304 102.576 800.213 104.859 798.549 107.76C796.885 110.661 795.648 113.968 794.837 117.68C794.026 121.349 793.621 125.189 793.621 129.2C793.621 134.533 794.346 139.568 795.797 144.304C797.29 148.997 799.53 152.795 802.517 155.696C805.546 158.597 809.322 160.048 813.845 160.048ZM865.62 175.664C863.401 175.664 861.503 174.896 859.924 173.36C858.388 171.781 857.62 169.861 857.62 167.6C857.62 165.424 858.388 163.547 859.924 161.968C861.503 160.389 863.401 159.6 865.62 159.6C867.839 159.6 869.737 160.389 871.316 161.968C872.895 163.547 873.684 165.424 873.684 167.6C873.684 169.861 872.895 171.781 871.316 173.36C869.737 174.896 867.839 175.664 865.62 175.664ZM936.439 78H952.055V174H936.439V166C934.391 168.859 931.81 171.184 928.695 172.976C925.58 174.768 921.975 175.664 917.879 175.664C913.228 175.664 908.876 174.789 904.823 173.04C900.77 171.291 897.186 168.88 894.071 165.808C890.999 162.693 888.588 159.109 886.839 155.056C885.09 151.003 884.215 146.651 884.215 142C884.215 137.349 885.09 132.997 886.839 128.944C888.588 124.891 890.999 121.328 894.071 118.256C897.186 115.141 900.77 112.709 904.823 110.96C908.876 109.211 913.228 108.336 917.879 108.336C921.975 108.336 925.58 109.232 928.695 111.024C931.81 112.773 934.391 115.099 936.439 118V78ZM918.071 160.624C921.399 160.624 924.343 159.792 926.903 158.128C929.463 156.464 931.468 154.224 932.919 151.408C934.37 148.549 935.095 145.413 935.095 142C935.095 138.544 934.37 135.408 932.919 132.592C931.468 129.733 929.442 127.472 926.839 125.808C924.279 124.144 921.356 123.312 918.071 123.312C914.786 123.312 911.778 124.165 909.047 125.872C906.359 127.536 904.204 129.776 902.583 132.592C901.004 135.408 900.215 138.544 900.215 142C900.215 145.456 901.026 148.592 902.647 151.408C904.268 154.224 906.423 156.464 909.111 158.128C911.842 159.792 914.828 160.624 918.071 160.624ZM994.59 175.664C988.702 175.664 983.326 174.149 978.462 171.12C973.641 168.091 969.779 164.016 966.878 158.896C964.019 153.776 962.59 148.123 962.59 141.936C962.59 137.285 963.422 132.933 965.086 128.88C966.75 124.784 969.033 121.2 971.934 118.128C974.878 115.013 978.291 112.581 982.174 110.832C986.057 109.083 990.195 108.208 994.59 108.208C999.582 108.208 1004.15 109.275 1008.29 111.408C1012.47 113.499 1016.01 116.379 1018.91 120.048C1021.81 123.717 1023.92 127.899 1025.25 132.592C1026.57 137.285 1026.87 142.192 1026.14 147.312H979.358C979.955 149.701 980.937 151.856 982.302 153.776C983.667 155.653 985.395 157.168 987.486 158.32C989.577 159.429 991.945 160.005 994.59 160.048C997.321 160.091 999.795 159.451 1002.01 158.128C1004.28 156.763 1006.15 154.928 1007.65 152.624L1023.58 156.336C1020.98 162.011 1017.1 166.661 1011.93 170.288C1006.77 173.872 1000.99 175.664 994.59 175.664ZM978.846 135.6H1010.33C1009.86 133.04 1008.86 130.736 1007.33 128.688C1005.83 126.597 1003.98 124.933 1001.76 123.696C999.539 122.459 997.15 121.84 994.59 121.84C992.03 121.84 989.662 122.459 987.486 123.696C985.31 124.891 983.454 126.533 981.918 128.624C980.425 130.672 979.401 132.997 978.846 135.6ZM1073.17 174H1053.01L1029.72 109.936H1046.36L1063.12 156.016L1079.83 109.936H1096.47L1073.17 174Z"
                fill="white" />
            <rect x="112.556" y="45" width="24.8889" height="168" fill="white" />
            <rect x="13" y="94.7778" width="24.8889" height="68.4444" fill="white" />
            <rect x="16.1111" y="141.444" width="24.8889" height="118.222" transform="rotate(-90 16.1111 141.444)"
                fill="white" />
        </symbol>
        <symbol id="pause" viewbox="0 -960 960 960">
            <path xmlns="http://www.w3.org/2000/svg" d="M540-128v-705h272v705H540Zm-392 0v-705h272v705H148Z" />
        </symbol>
        <symbol id="play" viewbox="0 -960 960 960">
            <path xmlns="http://www.w3.org/2000/svg" d="M275-124v-712l561 356-561 356Z" />
        </symbol>
        <symbol id="next" viewbox="0 -960 960 960">
            <path xmlns="http://www.w3.org/2000/svg" d="M682-162v-636h136v636H682Zm-540 0v-636l478 318-478 318Z" />
        </symbol>
        <symbol id="prev" viewbox="0 -960 960 960">
            <path xmlns="http://www.w3.org/2000/svg" d="M142-162v-636h136v636H142Zm676 0L340-480l478-318v636Z" />
        </symbol>
        <symbol id="shuffle" viewbox="0 -960 960 960">
            <path xmlns="http://www.w3.org/2000/svg"
                d="M556-114v-115h92L534-343l82-80 114 111v-90h116v288H556Zm-362-1-80-81 534-534h-92v-116h290v289H730v-92L194-115Zm155-416L114-765l80-81 237 234-82 81Z" />
        </symbol>
        <symbol id="repeat" viewbox="0 -960 960 960">
            <path xmlns="http://www.w3.org/2000/svg"
                d="M266-32 74-225l192-193 89 90-41 40h366v-161h126v287H314l41 40-89 90ZM154-500v-288h493l-40-39 88-90 193 192-193 193-88-90 40-40H280v162H154Z" />
        </symbol>
        <symbol id="plus" viewbox="0 -960 960 960">
            <path xmlns="http://www.w3.org/2000/svg" d="M412-412H154v-136h258v-259h136v259h258v136H548v258H412v-258Z" />
        </symbol>
    </defs>
</svg>

<body>
    <aside id="sidebar">
        <div id="user-info">
            Logged in as: <span id="username-display">Loading...</span>
            <button onclick="logout()">Logout</button>
        </div>
        <button id="home-button" class="selected">
            Home
        </button>
        <button id="search-button">
            Search
        </button>
        <button id="upload-button">
            Upload
        </button>
        <h2>My Library</h2>
        <div id="playlists-section">
            <ul id="playlists-list"></ul>
        </div>
    </aside>
    <div class="container">
        <header>
            <svg id="logo">
                <use href="#logo"></use>
            </svg>
        </header>
        <div class="content">

            <main>
                <section id="upload-section" class="hidden">
                    <h2>Upload Music</h2>
                    <form id="upload-form" enctype="multipart/form-data">
                        <input type="file" name="files" multiple required>
                        <div>
                            <label for="playlist-select">Select Playlist:</label>
                            <select id="playlist-select">
                                <option value="" selected disabled>Select Playlist</option>
                            </select>
                        </div>
                        <div>
                            <label for="new-playlist">Or Create New Playlist:</label>
                            <input type="text" id="new-playlist" placeholder="New Playlist Name">
                        </div>
                        <button type="submit" name="upload">Upload</button>
                        <label for="files" id="file-progress"></label>
                    </form>
                    <div id="upload-progress" class="loader hidden"></div>
                </section>

                <section id="search-section" class="hidden">
                    <h2>Search</h2>
                    <input type="text" id="search-input" placeholder="Search for music">
                    <div id="search-results"></div>
                </section>

                <section id="music-list-section">
                    <h2 id="music-list-title">Music List</h2>
                    <div id="music-list" class="music-list"></div>
                </section>
            </main>
        </div>

        <div id="playlist-menu" class="hidden">
            <h3>Select Playlist</h3>
            <div id="existing-playlists"></div>
            <h3>Create New Playlist</h3>
            <form id="create-playlist-form">
                <input type="text" name="playlist-name" placeholder="Playlist Name" required>
                <button type="submit">Create</button>
            </form>
        </div>

        <footer id="now-playing-container">
            <div id="cover-art-container" class="hidden">
                <img id="cover-art" src="" alt="Cover Art" />
            </div>
            <div id="data-scroll-container" class="hidden">
                <div id="data-scroll">
                    <span>2013 Album Lossless .FLAC 16-Bit 44.1kHz</span>
                    <span id="num2">2013 Album Lossless .FLAC 16-Bit 44.1kHz</span>
                    <span id="num3">2013 Album Lossless .FLAC 16-Bit 44.1kHz</span>
                    <span id="num4">2013 Album Lossless .FLAC 16-Bit 44.1kHz</span>
                </div>
            </div>
            <div class="slidecontainer">
                <input type="range" min="0" max="1000" value="0" class="slider" id="seek-slider">
            </div>
            <div id="now-playing">

                <div id="track-info">
                    <h3 id="track-title">No song selected</h3>
                    <p id="track-artist"></p>
                </div>
                <div id="audio-controls">
                    <button id="repeat-button" class="control-button">
                        <svg>
                            <use href="#repeat"></use>
                        </svg>
                    </button>

                    <button id="prev-button">
                        <svg>
                            <use href="#prev"></use>
                        </svg>
                    </button>
                    <button id="play-pause">
                        <svg id="play-icon">
                            <use href="#play"></use>
                        </svg>
                        <svg id="pause-icon" style="display: none;">
                            <use href="#pause"></use>
                        </svg>
                    </button>
                    <button id="next-button">
                        <svg>
                            <use href="#next"></use>
                        </svg>
                    </button>
                    <button id="shuffle-button" class="control-button">
                        <svg>
                            <use href="#shuffle"></use>
                        </svg>
                    </button>
                </div>
                <div class="volume">
                    <input type="range" min="0" max="100" value="100" class="slider" id="volume-slider">
                </div>
                <div class="playtime">
                    <span id="current-time">2:42</span> / <span id="duration">4:20</span>
                </div>
            </div>

            <audio id="audio-player"></audio>
        </footer>
    </div>

    <script src="script.js"></script>
</body>

</html>